{{!-- views/user/change-password.hbs --}}
<div class="container mx-auto px-4 md:px-8 lg:px-16 py-8">
  <div class="max-w-xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Change Password</h1>

    <!-- Alerts -->
    <div id="formSuccess" class="hidden alert alert-success shadow-lg mb-4"></div>
    <div id="formError" class="hidden alert alert-error shadow-lg mb-4"></div>

    <!-- Form -->
    <form id="changePasswordForm" class="space-y-4">
      <div class="form-control">
        <label class="label font-semibold text-gray-600">Current Password</label>
        <input
          type="password"
          id="currentPassword"
          name="currentPassword"
          class="input input-bordered w-full"
          required
        />
      </div>

      <div class="form-control">
        <label class="label font-semibold text-gray-600">New Password</label>
        <input
          type="password"
          id="newPassword"
          name="newPassword"
          class="input input-bordered w-full"
          required
        />
      </div>

      <div class="form-control">
        <label class="label font-semibold text-gray-600">Confirm New Password</label>
        <input type="password" id="confirmPassword" class="input input-bordered w-full" required />
      </div>

      <button type="submit" class="btn btn-primary w-full">Change Password</button>
    </form>
  </div>
</div>

<script>
  document.getElementById('changePasswordForm').addEventListener('submit', async (event) => {
    event.preventDefault() // Prevent default form submission

    // DOM elements
    const formSuccess = document.getElementById('formSuccess')
    const formError = document.getElementById('formError')
    const currentPassword = document.getElementById('currentPassword').value.trim()
    const newPassword = document.getElementById('newPassword').value.trim()
    const confirmPassword = document.getElementById('confirmPassword').value.trim()

    // Reset alerts
    formSuccess.classList.add('hidden')
    formError.classList.add('hidden')

    // Validate inputs
    if (!currentPassword) {
      formError.textContent = 'Current password is required!'
      formError.classList.remove('hidden')
      return
    }

    if (newPassword === currentPassword) {
      formError.textContent = 'New password cannot be the same as the current password!'
      formError.classList.remove('hidden')
      return
    }

    if (newPassword !== confirmPassword) {
      formError.textContent = 'Passwords do not match!'
      formError.classList.remove('hidden')
      return
    }

    try {
      // Send data via Axios
      const response = await axios.post('/user/change-password', {
        currentPassword,
        newPassword,
      })

      if (response.data.success) {
        formSuccess.textContent =
          response.data.message || 'Password changed successfully! Redirecting after 2 seconds...'
        formSuccess.classList.remove('hidden')

        // Redirect to the profile page after 2 seconds
        setTimeout(() => {
          window.location.href = '/user/profile'
        }, 2000)
      } else {
        throw new Error(response.data.message || 'Failed to change password.')
      }
    } catch (error) {
      formError.textContent =
        error.response?.data?.message || 'An error occurred. Please try again.'
      formError.classList.remove('hidden')
    }
  })
</script>
