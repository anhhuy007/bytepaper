{{!-- views/users/extend-subscription.hbs --}}
<div class="container mx-auto px-4 md:px-8 lg:px-16 py-8">
  <div class="max-w-xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Extend Subscription</h1>

    <!-- Alerts -->
    <div id="formSuccess" class="hidden alert alert-success shadow-lg mb-4"></div>
    <div id="formError" class="hidden alert alert-error shadow-lg mb-4"></div>

    <!-- Form -->
    <form id="extendSubscriptionForm" class="space-y-4">
      <div class="form-control">
        <label class="label font-semibold text-gray-600">Select Subscription Plan</label>
        <select id="subscriptionPlan" class="select select-bordered w-full" required>
          <option value="" disabled selected>Choose a plan</option>
          <option value="7">7 days - $5</option>
          <option value="30">30 days - $18</option>
          <option value="90">90 days - $50</option>
        </select>
      </div>

      <div class="form-control">
        <label class="label font-semibold text-gray-600">Price</label>
        <input
          type="text"
          id="priceDisplay"
          class="input input-bordered w-full"
          readonly
          placeholder="Select a plan to see the price"
        />
      </div>

      <button type="submit" class="btn btn-primary w-full">Extend Subscription</button>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const subscriptionPlan = document.getElementById('subscriptionPlan')
    const priceDisplay = document.getElementById('priceDisplay')
    const priceMap = {
      7: '$5',
      30: '$18',
      90: '$50',
    }

    // Update price display based on selected plan
    subscriptionPlan.addEventListener('change', () => {
      const selectedValue = subscriptionPlan.value
      priceDisplay.value = priceMap[selectedValue] || 'Select a plan to see the price'
    })

    document.getElementById('extendSubscriptionForm').addEventListener('submit', async (event) => {
      event.preventDefault() // Prevent form submission

      // DOM elements for feedback and selected plan
      const formSuccess = document.getElementById('formSuccess')
      const formError = document.getElementById('formError')
      const selectedPlan = subscriptionPlan.value

      // Reset alerts
      formSuccess.classList.add('hidden')
      formError.classList.add('hidden')

      if (!selectedPlan) {
        formError.textContent = 'Please select a subscription plan!'
        formError.classList.remove('hidden')
        return
      }

      try {
        // Send data via Axios
        const response = await axios.post('/user/extend-subscription', { days: selectedPlan })

        if (response.data.success) {
          formSuccess.textContent =
            response.data.message ||
            'Subscription extended successfully! Redirecting after 2 seconds...'
          formSuccess.classList.remove('hidden')

          // Redirect after 2 seconds
          setTimeout(() => {
            window.location.href = '/user/profile'
          }, 2000)
        } else {
          throw new Error(response.data.message || 'Failed to extend subscription.')
        }
      } catch (error) {
        formError.textContent =
          error.response?.data?.message || 'An error occurred. Please try again. ' + error.message
        formError.classList.remove('hidden')
      }
    })
  })
</script>
