{{!-- views/admin/assign-categories.hbs --}}
{{#extend "layouts/admin"}}

  {{#content "title"}}Assign Categories to Editors{{/content}}

  {{#content "body"}}
    <div class="container mx-auto px-4 py-8">
      <h1 class="text-3xl font-bold mb-6">Assign Categories</h1>

      {{#each editors}}
        <div class="mb-6">
          <h2 class="text-xl font-semibold">{{this.fullName}} ({{this.username}})</h2>
          <div class="form-control">
            <label class="label">Assigned Categories</label>
            <select class="select select-bordered w-full" multiple @change="assignCategories('{{this.id}}', $event.target.selectedOptions)">
              {{#each ../categories}}
                <option value="{{this.id}}" {{#if (includes ../this.assignedCategories this.id)}}selected{{/if}}>
                  {{this.name}}
                </option>
              {{/each}}
            </select>
          </div>
        </div>
      {{/each}}

      {{!-- Scripts --}}
      <script>
        function assignCategories() {
          return {
            async assignCategories(editorId, selectedOptions) {
              const categoryIds = Array.from(selectedOptions).map(option => option.value);
              try {
                await axios.post('/api/admin/assign-categories', {
                  editorId: editorId,
                  categoryIds: categoryIds,
                });
                alert('Categories assigned successfully.');
              } catch (error) {
                console.error(error);
                alert('An error occurred.');
              }
            },
          };
        }
      </script>
    </div>
  {{/content}}

{{/extend}}
