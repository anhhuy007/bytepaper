{{!-- views/admin/users.hbs --}}
{{#extend "layouts/admin"}}

  {{#content "title"}}Manage Users{{/content}}

  {{#content "body"}}
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Users Management</h1>
        <button class="btn btn-primary" @click="openModal('addUser')">Add User</button>
      </div>

      {{!-- Users Table --}}
      <div class="overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Username</th>
              <th>Full Name</th>
              <th>Email</th>
              <th>Role</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each users}}
              <tr>
                <td>{{this.username}}</td>
                <td>{{this.fullName}}</td>
                <td>{{this.email}}</td>
                <td>{{this.role}}</td>
                <td>
                  <button class="btn btn-xs btn-warning" @click="editUser({{json this}})">Edit</button>
                  <button class="btn btn-xs btn-error" @click="deleteUser('{{this.id}}')">Delete</button>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Add/Edit User Modal --}}
      <div x-data="{ isOpen: false, user: {}, isEdit: false }" x-show="isOpen">
        <div class="modal modal-open">
          <div class="modal-box">
            <h3 class="font-bold text-lg" x-text="isEdit ? 'Edit User' : 'Add User'"></h3>
            <form @submit.prevent="submitUser">
              <div class="form-control">
                <label class="label">Username</label>
                <input type="text" class="input input-bordered" x-model="user.username" required :readonly="isEdit" />
              </div>
              <div class="form-control">
                <label class="label">Full Name</label>
                <input type="text" class="input input-bordered" x-model="user.fullName" required />
              </div>
              <div class="form-control">
                <label class="label">Email</label>
                <input type="email" class="input input-bordered" x-model="user.email" required />
              </div>
              <div class="form-control">
                <label class="label">Role</label>
                <select class="select select-bordered" x-model="user.role" required>
                  <option disabled selected>Select Role</option>
                  {{#each roles}}
                    <option value="{{this}}">{{this}}</option>
                  {{/each}}
                </select>
              </div>
              {{#unless isEdit}}
                <div class="form-control">
                  <label class="label">Password</label>
                  <input type="password" class="input input-bordered" x-model="user.password" required />
                </div>
              {{/unless}}
              <div class="modal-action">
                <button type="button" class="btn" @click="isOpen = false">Cancel</button>
                <button type="submit" class="btn btn-primary" x-text="isEdit ? 'Update' : 'Create'"></button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {{!-- Scripts --}}
      <script>
        function userManagement() {
          return {
            isOpen: false,
            user: {},
            isEdit: false,
            openModal(action, user = {}) {
              this.isOpen = true;
              this.isEdit = action === 'edit';
              this.user = user;
            },
            async submitUser() {
              try {
                const url = this.isEdit ? '/api/admin/users/' + this.user.id : '/api/admin/users';
                const method = this.isEdit ? 'put' : 'post';
                await axios[method](url, this.user);
                window.location.reload();
              } catch (error) {
                console.error(error);
                alert('An error occurred.');
              }
            },
            async deleteUser(userId) {
              if (confirm('Are you sure you want to delete this user?')) {
                try {
                  await axios.delete('/api/admin/users/' + userId);
                  window.location.reload();
                } catch (error) {
                  console.error(error);
                  alert('An error occurred.');
                }
              }
            },
            editUser(user) {
              this.openModal('edit', user);
            },
          };
        }
      </script>
    </div>
  {{/content}}

{{/extend}}
