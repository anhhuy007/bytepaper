{{!-- views/admin/tags.hbs --}}
{{#extend "layouts/admin"}}

  {{#content "title"}}Manage Tags{{/content}}

  {{#content "body"}}
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Tags Management</h1>
        <button class="btn btn-primary" @click="openModal('addTag')">Add Tag</button>
      </div>

      {{!-- Tags Table --}}
      <div class="overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Name</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each tags}}
              <tr>
                <td>{{this.name}}</td>
                <td>
                  <button class="btn btn-xs btn-warning" @click="editTag({{json this}})">Edit</button>
                  <button class="btn btn-xs btn-error" @click="deleteTag('{{this.id}}')">Delete</button>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Add/Edit Tag Modal --}}
      <div x-data="{ isOpen: false, tag: {}, isEdit: false }" x-show="isOpen">
        <div class="modal modal-open">
          <div class="modal-box">
            <h3 class="font-bold text-lg" x-text="isEdit ? 'Edit Tag' : 'Add Tag'"></h3>
            <form @submit.prevent="submitTag">
              <div class="form-control">
                <label class="label">Name</label>
                <input type="text" class="input input-bordered" x-model="tag.name" required />
              </div>
              <div class="modal-action">
                <button type="button" class="btn" @click="isOpen = false">Cancel</button>
                <button type="submit" class="btn btn-primary" x-text="isEdit ? 'Update' : 'Create'"></button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {{!-- Scripts --}}
      <script>
        function tagManagement() {
          return {
            isOpen: false,
            tag: {},
            isEdit: false,
            openModal(action, tag = {}) {
              this.isOpen = true;
              this.isEdit = action === 'edit';
              this.tag = tag;
            },
            async submitTag() {
              try {
                const url = this.isEdit ? '/api/admin/tags/' + this.tag.id : '/api/admin/tags';
                const method = this.isEdit ? 'put' : 'post';
                await axios[method](url, this.tag);
                window.location.reload();
              } catch (error) {
                console.error(error);
                alert('An error occurred.');
              }
            },
            async deleteTag(tagId) {
              if (confirm('Are you sure you want to delete this tag?')) {
                try {
                  await axios.delete('/api/admin/tags/' + tagId);
                  window.location.reload();
                } catch (error) {
                  console.error(error);
                  alert('An error occurred.');
                }
              }
            },
            editTag(tag) {
              this.openModal('edit', tag);
            },
          };
        }
      </script>
    </div>
  {{/content}}

{{/extend}}
