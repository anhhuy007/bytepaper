{{!-- views/admin/categories.hbs --}}
{{#extend "layouts/admin"}}

  {{#content "title"}}Manage Categories{{/content}}

  {{#content "body"}}
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">Categories Management</h1>
        <button class="btn btn-primary" @click="openModal('addCategory')">Add Category</button>
      </div>

      {{!-- Categories Table --}}
      <div class="overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Name</th>
              <th>Parent Category</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each categories}}
              <tr>
                <td>{{this.name}}</td>
                <td>{{this.parentName}}</td>
                <td>
                  <button class="btn btn-xs btn-warning" @click="editCategory({{json this}})">Edit</button>
                  <button class="btn btn-xs btn-error" @click="deleteCategory('{{this.id}}')">Delete</button>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Add/Edit Category Modal --}}
      <div x-data="{ isOpen: false, category: {}, isEdit: false }" x-show="isOpen">
        <div class="modal modal-open">
          <div class="modal-box">
            <h3 class="font-bold text-lg" x-text="isEdit ? 'Edit Category' : 'Add Category'"></h3>
            <form @submit.prevent="submitCategory">
              <div class="form-control">
                <label class="label">Name</label>
                <input type="text" class="input input-bordered" x-model="category.name" required />
              </div>
              <div class="form-control">
                <label class="label">Parent Category</label>
                <select class="select select-bordered" x-model="category.parentId">
                  <option value="">None</option>
                  {{#each categories}}
                    <option value="{{this.id}}">{{this.name}}</option>
                  {{/each}}
                </select>
              </div>
              <div class="modal-action">
                <button type="button" class="btn" @click="isOpen = false">Cancel</button>
                <button type="submit" class="btn btn-primary" x-text="isEdit ? 'Update' : 'Create'"></button>
              </div>
            </form>
          </div>
        </div>
      </div>

      {{!-- Scripts --}}
      <script>
        function categoryManagement() {
          return {
            isOpen: false,
            category: {},
            isEdit: false,
            openModal(action, category = {}) {
              this.isOpen = true;
              this.isEdit = action === 'edit';
              this.category = category;
            },
            async submitCategory() {
              try {
                const url = this.isEdit ? '/api/admin/categories/' + this.category.id : '/api/admin/categories';
                const method = this.isEdit ? 'put' : 'post';
                await axios[method](url, this.category);
                window.location.reload();
              } catch (error) {
                console.error(error);
                alert('An error occurred.');
              }
            },
            async deleteCategory(categoryId) {
              if (confirm('Are you sure you want to delete this category?')) {
                try {
                  await axios.delete('/api/admin/categories/' + categoryId);
                  window.location.reload();
                } catch (error) {
                  console.error(error);
                  alert('An error occurred.');
                }
              }
            },
            editCategory(category) {
              this.openModal('edit', category);
            },
          };
        }
      </script>
    </div>
  {{/content}}

{{/extend}}
