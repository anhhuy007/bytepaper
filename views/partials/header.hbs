{{!-- views/partials/header.hbs --}}
<header class="bg-white shadow-md sticky top-0 z-50">
  <!-- Top Navigation -->
  <div class="navbar bg-base-100 px-10 py-4 items-center border-b-2">
    <div class="navbar-start space-x-4">
      <form action="/articles/filter" method="GET" class="grow max-w-[300px] items-start">
        <label class="input input-bordered flex items-center gap-2">
          <input type="text" name="keyword" placeholder="Search..." class="grow" value="" />
          <button type="submit" class="btn btn-square ml-9">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 16 16"
              fill="currentColor"
              class="h-4 w-4 opacity-70"
            >
              <path
                fill-rule="evenodd"
                d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </label>
      </form>
    </div>

    <div class="navbar-center hidden lg:block">
      <a class="btn btn-outline text-xl bg-black text-white" href="/">Paperly</a>
    </div>

    <!-- User Actions -->
    <div class="flex items-center gap-4 navbar-end">
      {{#if user}}
      <a href="/user/profile" class="btn btn-outline flex items-center gap-2">
        <i data-lucide="user"></i>
        <span>{{user.username}}</span>
      </a>
      <a href="/auth/logout" class="btn btn-primary flex items-center gap-2">
        <i data-lucide="log-out"></i>
        <span>Logout</span>
      </a>
      {{else}}
      <a href="/auth/login" class="btn btn-outline flex items-center gap-2">
        <i data-lucide="log-in"></i>
        <span>Login</span>
      </a>
      <a href="/auth/register" class="btn btn-primary flex items-center gap-2">
        <i data-lucide="user-plus"></i>
        <span>Register</span>
      </a>
      {{/if}}
    </div>
  </div>

  <!-- Category Navigation -->
  <nav class="bg-gray-100 shadow-sm">
    <div class="flex justify-center">
      <!-- Root Categories -->
      <ul class="flex items-center gap-5">
        {{#each header_categories}}
        <li class="dropdown dropdown-hover p-4 hover:border-b-2 border-primary box-border">
          <!-- Root Category -->
          <a href="/articles/categories/{{this.id}}">
            <div
              tabindex="{{@index}}"
              style="display: flex; align-items: center"
              class="hover:cursor-pointer"
            >
              <span class="whitespace-nowrap">{{this.name}}</span>
              {{#if this.children.length}}
              <i data-lucide="chevron-down" class="h-4 w-4" style="margin-left: 5px"></i>
              {{/if}}
            </div>
          </a>
          <!-- Child Categories -->
          {{#if this.children.length}}
          <ul
            class="dropdown-content menu mt-[18px] bg-white border border-gray-200 rounded-lg shadow-lg w-48 p-2 z-10"
          >
            {{#each this.children}}
            <li>
              <a
                href="/articles/categories/{{this.id}}"
                class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-primary transition"
              >
                {{this.name}}
              </a>
            </li>
            {{/each}}
          </ul>
          {{/if}}
        </li>
        {{/each}}
      </ul>
    </div>
  </nav>
</header>

<script>
  function toggleDropdown(el) {
    const dropdownState = el.getAttribute('data-dropdown') === 'true'
    const dropdownMenu = el.nextElementSibling
    if (!dropdownMenu) return

    if (dropdownState) {
      // Close dropdown
      dropdownMenu.style.opacity = 0
      dropdownMenu.style.visibility = 'hidden'
      dropdownMenu.style.pointerEvents = 'none'
      el.setAttribute('data-dropdown', 'false')
    } else {
      // Open dropdown
      dropdownMenu.style.opacity = 1
      dropdownMenu.style.visibility = 'visible'
      dropdownMenu.style.pointerEvents = 'auto'
      el.setAttribute('data-dropdown', 'true')
    }
  }
</script>
