{{!-- views/partials/header.hbs --}}
<header class="bg-white shadow-md sticky top-0 z-50">
  <!-- Top Navigation -->
  <div class="container mx-auto flex items-center justify-between px-4 md:px-16 lg:px-32 py-4">
    <!-- Logo -->
    <a
      href="/"
      class="flex items-center gap-2 text-2xl font-bold text-primary hover:text-primary-dark"
    >
      <i data-lucide="feather" class="h-6 w-6"></i>
      <span>Paperly</span>
    </a>

    <!-- Main Navigation -->
    <nav class="hidden md:flex items-center gap-8 text-gray-700">
      <a href="/" class="text-lg font-semibold hover:text-primary transition">Home</a>
      <a href="/articles/filter" class="text-lg font-semibold hover:text-primary transition"
        >Search</a
      >
    </nav>

    <!-- User Actions -->
    <div class="flex items-center gap-4">
      {{#if user}}
      <a href="/user/profile" class="btn btn-outline flex items-center gap-2">
        <i data-lucide="user"></i>
        <span>{{user.username}}</span>
      </a>
      <a href="/auth/logout" class="btn btn-primary flex items-center gap-2">
        <i data-lucide="log-out"></i>
        <span>Logout</span>
      </a>
      {{else}}
      <a href="/auth/login" class="btn btn-outline flex items-center gap-2">
        <i data-lucide="log-in"></i>
        <span>Login</span>
      </a>
      <a href="/auth/register" class="btn btn-primary flex items-center gap-2">
        <i data-lucide="user-plus"></i>
        <span>Register</span>
      </a>
      {{/if}}
    </div>
  </div>

  <!-- Category Navigation -->
  <nav class="bg-gray-100 shadow-sm">
    <div class="container mx-auto px-4 md:px-16 lg:px-32 py-2">
      <!-- Root Categories -->
      <ul class="flex items-center gap-6">
        {{#each header_categories}}
        <li class="relative">
          <!-- Root Category -->
          <a
            href="javascript:void(0)"
            class="hover:text-primary flex items-center gap-2 transition"
            onclick="toggleDropdown(this)"
            data-dropdown="false"
          >
            <span>{{this.name}}</span>
            {{#if this.children.length}}
            <i data-lucide="chevron-down" class="h-4 w-4"></i>
            {{/if}}
          </a>

          <!-- Child Categories -->
          {{#if this.children.length}}
          <div
            class="absolute left-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible transform transition duration-150 ease-in-out z-10 pointer-events-none"
          >
            <ul class="space-y-2">
              {{#each this.children}}
              <li>
                <a
                  href="/articles/categories/{{this.id}}"
                  class="block px-4 py-2 text-gray-700 hover:bg-gray-100 hover:text-primary transition"
                >
                  {{this.name}}
                </a>
              </li>
              {{/each}}
            </ul>
          </div>
          {{/if}}
        </li>

        {{/each}}
      </ul>
    </div>
  </nav>
</header>

<script>
  function toggleDropdown(el) {
    const dropdownState = el.getAttribute('data-dropdown') === 'true'
    const dropdownMenu = el.nextElementSibling
    if (!dropdownMenu) return

    if (dropdownState) {
      // Close dropdown
      dropdownMenu.style.opacity = 0
      dropdownMenu.style.visibility = 'hidden'
      dropdownMenu.style.pointerEvents = 'none'
      el.setAttribute('data-dropdown', 'false')
    } else {
      // Open dropdown
      dropdownMenu.style.opacity = 1
      dropdownMenu.style.visibility = 'visible'
      dropdownMenu.style.pointerEvents = 'auto'
      el.setAttribute('data-dropdown', 'true')
    }
  }
</script>
