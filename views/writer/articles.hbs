{{!-- views/writer/articles.hbs --}}
{{#extend "layouts/writer"}}

  {{#content "title"}}My Articles{{/content}}

  {{#content "body"}}
    <div class="container mx-auto px-4 py-8">
      <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold">My Articles</h1>
        <a href="/writer/articles/create" class="btn btn-primary">Create New Article</a>
      </div>

      {{!-- Filter Form --}}
      <form method="GET" class="flex items-center space-x-4 mb-6">
        <div class="form-control">
          <label class="label">Status</label>
          <select name="status" class="select select-bordered">
            <option value="">All</option>
            {{#each statuses}}
              <option value="{{this}}" {{#if (eq ../selectedStatus this)}}selected{{/if}}>{{this}}</option>
            {{/each}}
          </select>
        </div>
        <button type="submit" class="btn btn-primary mt-6">Filter</button>
      </form>

      {{!-- Articles Table --}}
      <div class="overflow-x-auto">
        <table class="table w-full">
          <thead>
            <tr>
              <th>Title</th>
              <th>Category</th>
              <th>Status</th>
              <th>Last Updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {{#each articles}}
              <tr>
                <td>{{this.title}}</td>
                <td>{{this.category.name}}</td>
                <td>{{this.status}}</td>
                <td>{{formatDate this.updatedAt}}</td>
                <td>
                  <a href="/writer/articles/edit/{{this.id}}" class="btn btn-xs btn-warning">Edit</a>
                  <button class="btn btn-xs btn-error" @click="deleteArticle('{{this.id}}')">Delete</button>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Scripts --}}
      <script>
        function articleManagement() {
          return {
            async deleteArticle(articleId) {
              if (confirm('Are you sure you want to delete this article?')) {
                try {
                  await axios.delete('/api/writer/articles/' + articleId);
                  window.location.reload();
                } catch (error) {
                  console.error(error);
                  alert('An error occurred.');
                }
              }
            },
          };
        }
      </script>
    </div>
  {{/content}}

{{/extend}}
