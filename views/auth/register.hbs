{{!-- views/auth/register.hbs --}}

<div class="min-h-screen flex items-center justify-center bg-base-200">
  <div class="w-full max-w-md">
    <div class="card bg-base-100 shadow-xl">
      <div class="card-body">
        <h2 class="card-title text-center">Create an Account</h2>

        {{!-- Alert for errors --}}
        <div id="alert" class="hidden alert alert-error shadow-lg mt-4">
          <div>
            {{> icons/alert}}
            <span id="alert-message"></span>
          </div>
        </div>

        <form id="register-form">
          <div class="form-control">
            <label class="label">
              <span class="label-text">Full Name</span>
            </label>
            <input
              type="text"
              name="full_name"
              placeholder="John Doe"
              class="input input-bordered"
              aria-label="Full Name"
              required
            />
          </div>

          <div class="form-control mt-4">
            <label class="label">
              <span class="label-text">Username</span>
            </label>
            <input
              type="text"
              name="username"
              placeholder="Username123"
              class="input input-bordered"
              aria-label="Username"
              required
            />
          </div>

          <div class="form-control mt-4">
            <label class="label">
              <span class="label-text">Email</span>
            </label>
            <input
              type="email"
              name="email"
              placeholder="user@example.com"
              class="input input-bordered"
              aria-label="Email"
              required
            />
          </div>

          <div class="form-control mt-4">
            <label class="label">
              <span class="label-text">Password</span>
            </label>
            <input
              type="password"
              name="password"
              placeholder="At least 8 characters"
              class="input input-bordered"
              aria-label="Password"
              required
            />
          </div>

          <div class="form-control mt-6">
            <button type="submit" class="btn btn-primary w-full">Register</button>
          </div>
        </form>

        <div class="divider">OR</div>

        <div class="flex justify-center">
          <a href="/auth/google" class="btn btn-outline w-full">
            {{> icons/google}} Sign up with Google
          </a>
        </div>

        <p class="text-center mt-4">
          Already have an account?
          <a href="/auth/login" class="text-primary">Login</a>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('register-form')
    const alertBox = document.getElementById('alert')
    const alertMessage = document.getElementById('alert-message')

    // Utility to show alert messages
    function showAlert(message) {
      alertMessage.textContent = message
      alertBox.classList.remove('hidden')
    }

    // Utility to hide alert messages
    function hideAlert() {
      alertMessage.textContent = ''
      alertBox.classList.add('hidden')
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault()

      // Gather form data
      const full_name = e.target.full_name.value.trim()
      const username = e.target.username.value.trim()
      const email = e.target.email.value.trim()
      const password = e.target.password.value.trim()

      // Clear previous alerts
      hideAlert()

      // Disable submit button to prevent duplicate requests
      const submitButton = e.target.querySelector('button[type="submit"]')
      submitButton.disabled = true

      try {
        // Send registration request
        const response = await axios.post('/auth/register', {
          full_name,
          username,
          email,
          password,
        })

        // Redirect to login page on success
        window.location.href = '/auth/login'
      } catch (error) {
        // Handle errors
        if (error.response && error.response.data && error.response.data.message) {
          showAlert(error.response.data.message)
        } else {
          showAlert('An unexpected error occurred. Please try again later.')
        }
      } finally {
        // Re-enable the submit button
        submitButton.disabled = false
      }
    })
  })
</script>
